---
title: "Create example plots and tables"
output: rmarkdown::html_vignette
editor_options: 
  chunk_output_type: inline
---

```{r include=FALSE}

knitr::opts_chunk$set(collapse = TRUE, comment = "#>", echo=TRUE)

library(tidyverse)
library(volker)
library(knitr)
theme_set(theme_bw())

data <- volker::chatgpt

# Recode -9 to NA
data <- mutate(data, across(starts_with("cg_adoption_"), ~ na_if(.,-9)  ))

# Add label to sd_geschlecht and recode levels
data <- data %>% 
  labs_apply(tibble("sd_geschlecht", "Gender")) %>% 
  mutate(
    sd_geschlecht = recode(
      sd_geschlecht,
      "m√§nnlich" = "male",
      "weiblich" = "female",
      "divers" = "diverse"
    )
  )

# Add label to sd_alter
data <- labs_apply(data, tibble("sd_alter","Age"))

```

## 1. One variable

### Frequency table for one categorical variable: Gender
```{r results='asis'}

data %>% 
  tab_counts(sd_geschlecht)

```

### Distribution table for one metric variable: Age
```{r results='asis'}

data %>%
  tab_metrics(sd_alter)

```

## 2. Multiple items

### Frequency table for multiple categorical variables: Adoption factors
```{r results='asis'}


newlabels <- tribble(
  ~item_name, ~item_label,
  "cg_adoption_advantage_01", "General Benefits",
  "cg_adoption_advantage_02", "Financial Benefits",
  "cg_adoption_advantage_03", "Workplace Benefits",
  "cg_adoption_advantage_04", "Joy Benefits"
)

data %>% 
  labs_apply(newlabels) %>% 
  filter(
    cg_adoption_advantage_01 < 4,
    cg_adoption_advantage_02 < 4,
    cg_adoption_advantage_03 < 4,
    cg_adoption_advantage_04 < 4
    
  ) %>% 
  tab_counts(starts_with("cg_adoption_advantage_"))

```

### Distribution table for multiple metric items: Adoption factors
```{r results='asis'}


data %>% 
  labs_apply(newlabels) %>% 
  tab_item_metrics(starts_with("cg_adoption_advantage_"))

```

## 3. Two variables (one being categorical)

### Cross table of categorical variables: Innovator type by gender

```{r results='asis'}

data %>% 
  mutate(in_adoption = case_when(
    str_detect(in_adoption,"Ich probiere ") ~ "I try quickly",
    str_detect(in_adoption,"Ich warte eher ab") ~ "I tend to wait",
    str_detect(in_adoption,"wenn ich nicht mehr anders kann") ~ "Only when necessary",
  )) %>% 
  volker::labs_apply(tibble("in_adoption","Adopter type")) %>% 
  tab_counts(in_adoption, sd_geschlecht)

```

### Group comparison of a metric variable: Age by gender

```{r results='asis'}

tab_metrics_one_grouped(data, sd_alter, sd_geschlecht)

```

## 4. Multiple metric variables

### Compare means of multiple items: Adoption factors by gender
```{r results='asis'}

data %>% 
  labs_apply(newlabels) %>% 
  tab_multi_means(starts_with("cg_adoption_advantage"), sd_geschlecht)

```

### Correlation of items: Adoption factors by adoption factors
```{r results='asis'}

data %>% 
  labs_apply(newlabels) %>% 
  tab_multi_corr(starts_with("cg_adoption_advantage"))

```
### Create hex-sticker
```{r results='asis'}
library(hexSticker)
library(ggplot2)
library(showtext)

# Add google font
font_add_google("Roboto Mono", "robo_mono")

# Data for bar chart
bar_data <- tibble(
  cat = c("A", "B", "C", "D"),
  val = c(4, 7, 6, 9)
)

# Bar chart
bar_plot <- ggplot(bar_data, aes(x=cat, y=val, fill=cat)) +
  geom_bar(stat="identity") +
  scale_fill_manual(values = c("A" = "#96dfde", "B" = "#008b8b", "C" = "#006363", "D" = "black")) +
  theme_void() +
  theme(legend.position="none") 


# GenerateSticker
s <- sticker(bar_plot, 
        package = "volkeR",
        p_size = 15,             
        #p_color = "#008b8b",
        p_color = "black",
        p_family="robo_mono",
        p_y = 0.53,
        s_x = 1,                  
        s_y = 1.1,
        s_width = 0.95, 
        s_height = 0.95,
        h_fill="transparent",
        h_color="#006363",
        filename = "hex_sticker.png"
)


plot(s)

```
