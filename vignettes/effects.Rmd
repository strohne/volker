---
title: "All kinds of statistics: effect sizes, parameter estimates, p values"
output: volker::html_report
vignette: >
  %\VignetteIndexEntry{Effects}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r include=FALSE}
knitr::opts_chunk$set(echo = F)

library(tidyverse)
library(volker)
```

```{r}

# Load data 
data <- volker::chatgpt
```

| \#      | function                     | implemented | effect calculations                                                   |
|---------|------------------------------|-------------|-----------------------------------------------------------------------|
| 1       | effect_counts_one            | not yet     | Compare to equality (Gini Coefficient, Goodness of fit) |
| 2       | effect_counts_one_grouped    |             | Contingency of two variables (Cramér's V, Chi squared) |
| 3       | effect_counts_one_cor        | not yet     | Explained variance (Pseudo-R-squared of logistic regression) |
| 4       | effect_counts_items          | not yet     | Contingency between each of the items (Cramér's V) |
| 5       | effect_counts_items_grouped  | not yet     | Contingency between each item and the grouping variable (Cramér's V) |
| 6       | effect_counts_items_cor      | not yet     | Explained variance of each item by the metric variable (Pseudo-R-squared of logistic regression) |
| 7       | effect_metrics_one           | not yet     | Compare to normality (Shapiro-Wilk-Normality-test) |
| 8       | effect_metrics_one_grouped   |             | Explained variance (R squared, t-test) |
| 9       | effect_metrics_one_cor       |             | Correlation (Pearson's r, Spearman's rho, t-test) |
| 10      | effect_metrics_items         |             | Correlation between items (Pearsons'r, R squared, t-test) | 
| 11      | effect_metrics_items_grouped | not yet     | Explained variance of each item by the grouping variable (R squared) |
| 12      | effect_metrics_items_cor     |             | Correlation between each item and the correlation variable (Pearson's r, Spearman's rho, t-test) |

# Categorical variables

## 1. Inequality of counts (Chi-squared test for equal distribution, Gini-coefficient)
```{r}
data %>%  
  filter(sd_gender != "diverse") |> 
  effect_counts(sd_gender)
```

## 2. Cross table
```{r}
effect_counts(data, adopter, sd_gender)
```

## 3. Logistic regression with one metric predictor
```{r}
# TODO: better way? ; add macro statistics ; make clean ; remove new package...? 
effect_counts(data, adopter, sd_age, metric = TRUE)
```

## 4. Chi-square goodness-of-fit test for each item
```{r}
effect_counts(data, starts_with("cg_adoption_advantage"))
```

## 5. Cramers v and Chi-square-test for each item
```{r}
# TODO
#effect_counts(data, starts_with("cg_adoption_advantage"), sd_gender)
```

## 6. Explained variance of each item by the metric variable (Pseudo-R-squared of logistic regression) |
```{r}
# TODO
#effect_counts(data, starts_with("cg_adoption_advantage"), sd_age)
```

# Metric variables

## 7. Normality test for one metric variable
```{r}
effect_metrics(data, sd_age)
```

## 8. T-test / ANOVA
```{r}
# Add standardized beta coefficents: but not that easy to implement and 
# interpret, because its categorical data?  
effect_metrics(data, sd_age, adopter)
fit <- stats::lm(sd_age ~ adopter, data = data)
```

## 9. Correlation test
```{r}
# Done: added R-squared. Future: implement lm logic instead of effect_correlations? 
effect_metrics(data, sd_age, use_private, metric=T)
```

## 10. Distribution test for each item
```{r}
# TODO: wie bei effect_counts_items() auch hier statt Korrelationsmatrix 
#       skewness, kurtosis, W-Test-STatistiken für jedes ITem
# Done: truncate labels
effect_metrics(data, starts_with("cg_adoption"))
```

## 11. Analysis of variance 
```{r}
# TODO: Check calculation 
# TODO: Mittelwerte und ci raus, stattdessen in tab_metrics_items_grouped() einen ci-PArameter ergänzen, der statt sd dann ci (in eckigen Klammern) in den output zipped 
# Done: Brackets of confidence intervals, add eta 
effect_metrics(data, starts_with("cg_adoption_"), adopter)
```

## 12. Correlation between items and one variable
```{r}

# TODO: Spalte "Item 2" rausnehmen, stattdessen die Beschriftung "Item 1" ändern zu "Correlation with Age".
#       Außerdem darauf achten, dass das Präfix ("Expectations") rausgenommen wird und vor die Beschriftung kommt.
#       Also: "Expectations: Correlation with Age"
# Done: fix label = F, add prefix in title column.. 
# Maybe todo: remove "item2"? 
effect_metrics(data, starts_with("cg_adoption"), sd_age, metric = TRUE)
```

# Correlations

## a) Correlation of metric items with metric items

```{r}
# equivalent to plot_metrics_items_cor_items?  
effect_metrics(
  data, starts_with("cg_adoption"), starts_with("use_"), 
  metric = TRUE,
)

```

## b) Correlation of metric items with categorical items

```{r}
# TODO
# effect_metrics(data, starts_with("cg_adoption_adv"), starts_with("use_"))
```


## c) Correlation of categorical items with metric items

```{r}
# TODO
#effect_counts(data, starts_with("cg_adoption_adv"), starts_with("cg_adoption_adv"), metric = TRUE)
```

## d) Correlation of categorical items with categorical items

```{r}
# TODO
#effect_counts(data, starts_with("cg_adoption_adv"), starts_with("use_"))

```
