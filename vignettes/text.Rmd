---
title: "Topic modeling"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Topic modeling}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r include=FALSE}
knitr::opts_chunk$set(collapse = TRUE, comment = "#>", echo = TRUE)

# Load packages
library(tidyverse)
library(volker)

theme_set(theme_bw())

data <- volker::chatgpt

```


The topic modeling pipeline is still experimental.
You can catch a view on the planned outputs
but don't expect valid results.


```{r results='asis'}

# Perform topic modeling. 
# This results in some new topic columns.
# The model itself is stored as an attribute of the tpc_topic column.
topics <- data |> 
  select(case, cg_activities) |> 
  lda_report(cg_activities, k= 3, lambda=0.6)

# Extract the phi / probability matrix
lda_fit <- attr(topics$tpc_topic,"lda")
lda_phi <- modeltools::posterior(lda_fit)$terms %>% as.matrix()

# Rows sum up to 1 because each topic generates a word, we just don't know which word
rowSums(lda_phi)

# TODO: Is the relevance calculation correct? Does it make sense?
# See text_relevance.R
lda_rel <- volker:::relevance(lda_phi, 0.6)

```
